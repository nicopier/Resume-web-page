<div class="reset-wrap">
  <h1 i18n="@@reset.title">Restablecer contraseña</h1>
  <p i18n="@@reset.subtitle">
    Ingresá tu nueva contraseña y confirmala para continuar.
  </p>

  <!-- Mensajes globales -->
  <div class="ok" *ngIf="success">
  <span i18n="@@reset.success">¡Contraseña actualizada! Ya podés </span>
  <a routerLink="/auth/login" class="login-link" i18n="@@reset.loginLink">
    iniciar sesión
  </a>.
</div>
  <div class="err" *ngIf="errorMsg">{{ errorMsg }}</div>

  <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
    <!-- Password -->
    <label for="password" i18n="@@reset.label.password">Nueva contraseña</label>
    <input
      id="password"
      type="password"
      formControlName="password"
      autocomplete="new-password"
      [class.invalid]="f.password.touched && f.password.invalid"
    />

    <div class="err" *ngIf="f.password.touched && f.password.invalid">
      <span *ngIf="f.password.errors?.['required']" i18n="@@reset.error.password.required">
        La contraseña es obligatoria.
      </span>
      <span *ngIf="f.password.errors?.['minlength']" i18n="@@reset.error.password.min">
        Debe tener al menos 8 caracteres.
      </span>
    </div>

    <!-- Confirm -->
    <label for="confirm" i18n="@@reset.label.confirm">Confirmar contraseña</label>
    <input
      id="confirm"
      type="password"
      formControlName="confirm"
      autocomplete="new-password"
      [class.invalid]="(f.confirm.touched && f.confirm.invalid) || form.errors?.['mismatch']"
    />

        <!-- Mensajes de error específicos por código -->
    <div class="err" *ngIf="errorCode === 'TOKEN_INVALID_OR_EXPIRED'" i18n="@@reset.err.tokenInvalid">
      El enlace es inválido o expiró.
    </div>

    <div class="err" *ngIf="errorCode === 'TOKEN_USER_NOT_FOUND'" i18n="@@reset.err.userNotFound">
      Usuario no encontrado.
    </div>

    <div class="err" *ngIf="errorCode === 'TOKEN_VERSION_MISMATCH'" i18n="@@reset.err.tokenUsed">
      El enlace ya fue usado o caducó.
    </div>

    <!-- Fallback genérico si no hay code -->
    <div class="err" *ngIf="!errorCode && errorMsg">{{ errorMsg }}</div>  

    <!-- Botón -->
    <button
      type="submit"
      [disabled]="loading || form.invalid"
      class="btn primary"
    >
      <ng-container *ngIf="!loading" i18n="@@reset.button">Cambiar contraseña</ng-container>
      <ng-container *ngIf="loading" i18n="@@reset.saving">Guardando…</ng-container>
    </button>
  </form>
</div>
